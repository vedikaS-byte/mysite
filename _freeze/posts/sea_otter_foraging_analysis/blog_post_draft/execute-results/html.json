{
  "hash": "e4b17bd11f529b2a677532cd15bbb958",
  "result": {
    "markdown": "---\ntitle: \"\"\nformat: html\n---\n\n\n# Assessing Sea Otter Feeding Habitats Based on Prey Type and Dive Depth\n\n### **Purpose**\n\nThe sea otter (*Enhydra lutris)* is a highly social marine mammal that plays a vital role as a keystone species in maintaining the health of kelp forest ecosystems by keeping sea urchin populations in check. While sea otters are primary predators of sea urchins, their diets are shown to be varied. For example, sea otters are known to eat (SOURCE). Sea urchins. Because of their important role as a keystone species, understanding their diet and foraging patterns is essential for assessing feeding preferences and food availability in conservation. \\[ADD DISTRIBUTION\\].\n\nThis blog post aims to present and discuss the results of a statistical regression analysis conducted on sea otter foraging data collected from visual observations in Prince of Wales, Alaska, by LaRoche et al. (2018). A beta regression using `betareg` with a zero-adjustment was selected for the analysis in order to assess the proportion of prey not consumed by sea otters during summer 2018. Both the age and sex of observed sea otters were considered as potential confounding variables impacting diving time. The following question was utilized to guide the analysis:\n\n**How does prey categorization and dive depth predict the proportion of prey not eaten?**\n\nThe mean proportion not eaten was modeled using a Beta regression with a logit link, while a precision parameter (φ) captured the variability in proportions around the mean.\n\n-   Hypothesis 1:\n\n    -   H~0~: β~prey_cat_urchins~ = 0. There is no difference in the proportion of prey not eaten between\n\n    -   HA: β~prey_cat_urchins~ ≠ 0.\n\n-   Hypothesis 2:\n\n    -   H0: β~dive_time~ = 0\n\n    -   HA: β~dive_time~ ≠ 0\n\n-   \n\n-   The blog post provides context and background for the question\n\n-   The data are explained using text and figures\n\n-   The relationships and causal relationships are described with a DAG\n\n### Data Importation, Exploration, and Cleaning\n\nThis project uses \\[VARIABLES\\]:\n\n-   \n\n-   \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(here)\nlibrary(tidyverse)\nlibrary(betareg) # https://cran.r-project.org/web/packages/betareg/vignettes/betareg.html#sec-model\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)\nforage <- read_csv(\"forage_final (1).csv\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Structure\nstr(forage)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nspc_tbl_ [4,457 × 36] (S3: spec_tbl_df/tbl_df/tbl/data.frame)\n $ BoutID                 : chr [1:4457] \"2018-001\" \"2018-001\" \"2018-001\" \"2018-001\" ...\n $ Study                  : chr [1:4457] \"POW\" \"POW\" \"POW\" \"POW\" ...\n $ Date                   : chr [1:4457] \"5/6/18\" \"5/6/18\" \"5/6/18\" \"5/6/18\" ...\n $ BoutStart              : 'hms' num [1:4457] 11:24:00 11:24:00 11:24:00 11:24:00 ...\n  ..- attr(*, \"units\")= chr \"secs\"\n $ BoutEnd                : 'hms' num [1:4457] 11:51:00 11:51:00 11:51:00 11:51:00 ...\n  ..- attr(*, \"units\")= chr \"secs\"\n $ DiveNo                 : num [1:4457] 1 2 3 4 5 6 7 8 9 10 ...\n $ DT                     : num [1:4457] 76 135 55 52 40 81 58 46 42 12 ...\n $ ST                     : num [1:4457] 33 26 12 21 17 22 60 9 13 30 ...\n $ Suc                    : chr [1:4457] \"N\" \"Y\" \"Y\" \"Y\" ...\n $ HT                     : num [1:4457] NA 24 12 21 17 NA 60 9 NA 12 ...\n $ PreyItem               : chr [1:4457] NA \"SAG\" \"CLA\" \"CLA\" ...\n $ PreyQty                : num [1:4457] NA 1 1 2 1 NA 1 1 NA 1 ...\n $ PreySz                 : chr [1:4457] NA \"2A\" \"1C\" \"1C\" ...\n $ PropNotEat             : num [1:4457] NA NA NA NA NA NA 0.3 NA NA NA ...\n $ Why....Notes...Tool.Use: chr [1:4457] NA NA NA NA ...\n $ Region                 : chr [1:4457] \"SHINAKU INLET\" \"SHINAKU INLET\" \"SHINAKU INLET\" \"SHINAKU INLET\" ...\n $ YEAR                   : num [1:4457] 2003 2003 2003 2003 2003 ...\n $ ObsLatDeg              : num [1:4457] 55.6 55.6 55.6 55.6 55.6 ...\n $ ObsLongDeg             : num [1:4457] -133 -133 -133 -133 -133 ...\n $ OtterLatDeg            : num [1:4457] 55.6 55.6 55.6 55.6 55.6 ...\n $ OtterLongDeg           : num [1:4457] -133 -133 -133 -133 -133 ...\n $ age                    : chr [1:4457] \"A\" \"A\" \"A\" \"A\" ...\n $ sex                    : chr [1:4457] \"U\" \"U\" \"U\" \"U\" ...\n $ pup                    : chr [1:4457] NA NA NA NA ...\n $ where                  : chr [1:4457] \"OW\" \"OW\" \"OW\" \"OW\" ...\n $ obscond                : chr [1:4457] \"VG\" \"VG\" \"VG\" \"VG\" ...\n $ Rain                   : chr [1:4457] \"NONE\" \"NONE\" \"NONE\" \"NONE\" ...\n $ Sky                    : num [1:4457] 0 0 0 0 0 0 0 0 0 0 ...\n $ observer               : chr [1:4457] \"NLL\" \"NLL\" \"NLL\" \"NLL\" ...\n $ recorder               : chr [1:4457] \"CLD/YBB\" \"CLD/YBB\" \"CLD/YBB\" \"CLD/YBB\" ...\n $ EnteredBy              : chr [1:4457] \"NLL\" \"NLL\" \"NLL\" \"NLL\" ...\n $ checked.by             : chr [1:4457] \"SLK\" \"SLK\" \"SLK\" \"SLK\" ...\n $ PreyCat                : chr [1:4457] NA \"Clam\" \"Clam\" \"Clam\" ...\n $ Occupation             : chr [1:4457] \"15 years\" \"15 years\" \"15 years\" \"15 years\" ...\n $ julian                 : num [1:4457] 126 126 126 126 126 126 126 126 126 126 ...\n $ Season                 : chr [1:4457] \"Spring\" \"Spring\" \"Spring\" \"Spring\" ...\n - attr(*, \"spec\")=\n  .. cols(\n  ..   BoutID = col_character(),\n  ..   Study = col_character(),\n  ..   Date = col_character(),\n  ..   BoutStart = col_time(format = \"\"),\n  ..   BoutEnd = col_time(format = \"\"),\n  ..   DiveNo = col_double(),\n  ..   DT = col_double(),\n  ..   ST = col_double(),\n  ..   Suc = col_character(),\n  ..   HT = col_double(),\n  ..   PreyItem = col_character(),\n  ..   PreyQty = col_double(),\n  ..   PreySz = col_character(),\n  ..   PropNotEat = col_double(),\n  ..   Why....Notes...Tool.Use = col_character(),\n  ..   Region = col_character(),\n  ..   YEAR = col_double(),\n  ..   ObsLatDeg = col_double(),\n  ..   ObsLongDeg = col_double(),\n  ..   OtterLatDeg = col_double(),\n  ..   OtterLongDeg = col_double(),\n  ..   age = col_character(),\n  ..   sex = col_character(),\n  ..   pup = col_character(),\n  ..   where = col_character(),\n  ..   obscond = col_character(),\n  ..   Rain = col_character(),\n  ..   Sky = col_double(),\n  ..   observer = col_character(),\n  ..   recorder = col_character(),\n  ..   EnteredBy = col_character(),\n  ..   checked.by = col_character(),\n  ..   PreyCat = col_character(),\n  ..   Occupation = col_character(),\n  ..   julian = col_double(),\n  ..   Season = col_character()\n  .. )\n - attr(*, \"problems\")=<externalptr> \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n## drop NAs\ncolSums(is.na(forage))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                 BoutID                   Study                    Date \n                      0                       0                       0 \n              BoutStart                 BoutEnd                  DiveNo \n                      0                       0                       0 \n                     DT                      ST                     Suc \n                      7                     118                       4 \n                     HT                PreyItem                 PreyQty \n                    641                     480                     484 \n                 PreySz              PropNotEat Why....Notes...Tool.Use \n                    484                    4033                    3049 \n                 Region                    YEAR               ObsLatDeg \n                      0                       0                       0 \n             ObsLongDeg             OtterLatDeg            OtterLongDeg \n                      0                       0                       0 \n                    age                     sex                     pup \n                      0                       0                    3343 \n                  where                 obscond                    Rain \n                     19                       0                       0 \n                    Sky                observer                recorder \n                      0                       0                       0 \n              EnteredBy              checked.by                 PreyCat \n                      0                      28                    1541 \n             Occupation                  julian                  Season \n                      0                       0                       0 \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Select for just prey category, diving time, and prey handling time \n# table(forage$age)\n# table(forage$sex)\nforage <- forage %>% select(BoutID, PreyCat, PreyItem, DT, HT,PropNotEat, age)\nforage <- forage %>% filter(age != \"U\") \nforage <- forage %>% drop_na()\n\ndim(forage)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 304   7\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Check the colSums... were they all dropped?\ncolSums(is.na(forage)) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n    BoutID    PreyCat   PreyItem         DT         HT PropNotEat        age \n         0          0          0          0          0          0          0 \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a scatterplot of dive time related to the proportion of prey not eaten based on prey category\nforage %>% ggplot(aes(x = DT, y = PropNotEat))+ geom_jitter() + theme_bw() +  #+ scale_color_discrete(palette = \"Set2\") + \n#   #facet_wrap(~PreyCat, scale = \"free\") + \n  #theme(legend.position = \"none\") + \nlabs(x = \"Diving Time (seconds)\", y = \"Proportion of Prey Not Eaten\", \n                                               title = \"Proportion of Prey Not Consumed By Sea Otters Based on Diving Time\") + theme(plot.title = element_text(size = 11, face = \"bold\"))\n```\n\n::: {.cell-output-display}\n![](blog_post_draft_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Create boxplots to visualize the distribution of prey categories and proportion of prey not eaten\nforage %>% ggplot(aes(x = PreyCat, y = PropNotEat, fill = PreyCat)) + geom_boxplot() + theme_bw()\n```\n\n::: {.cell-output-display}\n![](blog_post_draft_files/figure-html/unnamed-chunk-7-2.png){width=672}\n:::\n:::\n\n\n### **Statistical model**\n\n\\[stat notation\\]\n\nHere, simulated data was generated to\n\n`betareg(formula, data, subset, na.action, weights, offset, link = \"logit\", link.phi = NULL, control = betareg.control(...), model = TRUE, y = TRUE, x = FALSE, ...)`\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Beta does not take direct 0 and 1! need to do adjustment to offset before 1 and after 0 ()\nforage <- forage %>%\n  mutate(PropNotEat_adj = # Transformation to adjust (betareg cranr)\n           (PropNotEat * (nrow(.) - 1) + 0.5) / nrow(.))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Model with interaction\nforage_interaction_added <- betareg(PropNotEat_adj ~ PreyCat * DT + age, data = forage)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in betareg.fit(X, Y, Z, weights, offset, link, link.phi, type, control,\n: no valid starting value for precision parameter found, using 1 instead\n```\n:::\n\n```{.r .cell-code}\n# Model with interaction\nforage_interaction <- betareg(PropNotEat_adj ~ PreyCat * DT, data = forage)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in betareg.fit(X, Y, Z, weights, offset, link, link.phi, type, control,\n: no valid starting value for precision parameter found, using 1 instead\n```\n:::\n\n```{.r .cell-code}\n# Model with interaction\nforage_interaction_age <- betareg(PropNotEat_adj ~ PreyCat + DT*age, data = forage)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in betareg.fit(X, Y, Z, weights, offset, link, link.phi, type, control,\n: no valid starting value for precision parameter found, using 1 instead\n```\n:::\n\n```{.r .cell-code}\nsummary(forage_interaction_age)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nbetareg(formula = PropNotEat_adj ~ PreyCat + DT * age, data = forage)\n\nQuantile residuals:\n    Min      1Q  Median      3Q     Max \n-1.8218 -0.6847 -0.2759  0.0956  2.9494 \n\nCoefficients (mean model with logit link):\n                 Estimate Std. Error z value Pr(>|z|)    \n(Intercept)      0.659404   0.167937   3.927 8.62e-05 ***\nPreyCatCrab     -0.274429   0.165625  -1.657  0.09753 .  \nPreyCatCucumber -0.409292   0.238509  -1.716  0.08615 .  \nPreyCatStar     -0.012105   0.471555  -0.026  0.97952    \nPreyCatUrchin   -0.182964   0.340366  -0.538  0.59089    \nDT              -0.004529   0.001481  -3.058  0.00223 ** \nageJ            -0.824783   2.424516  -0.340  0.73372    \nDT:ageJ          0.018273   0.046002   0.397  0.69120    \n\nPhi coefficients (precision model with identity link):\n      Estimate Std. Error z value Pr(>|z|)    \n(phi)   1.7881     0.1211   14.76   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 \n\nType of estimator: ML (maximum likelihood)\nLog-likelihood: 11.84 on 9 Df\nPseudo R-squared: 0.03302\nNumber of iterations: 32 (BFGS) + 2 (Fisher scoring) \n```\n:::\n\n```{.r .cell-code}\n# Control variable/additional variable inclusion beta regression\nforage_beta <- betareg(PropNotEat_adj ~ PreyCat + DT + age, data = forage)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in betareg.fit(X, Y, Z, weights, offset, link, link.phi, type, control,\n: no valid starting value for precision parameter found, using 1 instead\n```\n:::\n\n```{.r .cell-code}\nsummary(forage_beta)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nbetareg(formula = PropNotEat_adj ~ PreyCat + DT + age, data = forage)\n\nQuantile residuals:\n    Min      1Q  Median      3Q     Max \n-1.8224 -0.6818 -0.2775  0.0939  2.9459 \n\nCoefficients (mean model with logit link):\n                 Estimate Std. Error z value Pr(>|z|)    \n(Intercept)      0.659968   0.167951   3.930 8.51e-05 ***\nPreyCatCrab     -0.280862   0.164865  -1.704  0.08846 .  \nPreyCatCucumber -0.410692   0.238514  -1.722  0.08509 .  \nPreyCatStar     -0.013533   0.471602  -0.029  0.97711    \nPreyCatUrchin   -0.184814   0.340377  -0.543  0.58715    \nDT              -0.004519   0.001481  -3.051  0.00228 ** \nageJ             0.092024   0.808221   0.114  0.90935    \n\nPhi coefficients (precision model with identity link):\n      Estimate Std. Error z value Pr(>|z|)    \n(phi)   1.7871     0.1211   14.76   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 \n\nType of estimator: ML (maximum likelihood)\nLog-likelihood: 11.76 on 8 Df\nPseudo R-squared: 0.03259\nNumber of iterations: 15 (BFGS) + 2 (Fisher scoring) \n```\n:::\n\n```{.r .cell-code}\nforage$PropNotEat_adj\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  [1] 0.69934211 0.99835526 0.79901316 0.50000000 0.50000000 0.50000000\n  [7] 0.33055921 0.69934211 0.50000000 0.50000000 0.50000000 0.79901316\n [13] 0.20098684 0.40032895 0.50000000 0.50000000 0.50000000 0.99835526\n [19] 0.10131579 0.20098684 0.99835526 0.10131579 0.50000000 0.50000000\n [25] 0.20098684 0.10131579 0.20098684 0.79901316 0.50000000 0.20098684\n [31] 0.10131579 0.20098684 0.20098684 0.99835526 0.20098684 0.20098684\n [37] 0.33055921 0.50000000 0.25082237 0.50000000 0.50000000 0.79901316\n [43] 0.99835526 0.50000000 0.25082237 0.50000000 0.50000000 0.74917763\n [49] 0.50000000 0.99835526 0.59967105 0.10131579 0.10131579 0.10131579\n [55] 0.50000000 0.50000000 0.79901316 0.50000000 0.50000000 0.30065789\n [61] 0.50000000 0.50000000 0.10131579 0.50000000 0.50000000 0.25082237\n [67] 0.20098684 0.33055921 0.50000000 0.50000000 0.99835526 0.50000000\n [73] 0.74917763 0.50000000 0.33055921 0.33055921 0.99835526 0.50000000\n [79] 0.25082237 0.25082237 0.33055921 0.25082237 0.50000000 0.99835526\n [85] 0.33055921 0.66645066 0.99835526 0.15115132 0.10131579 0.50000000\n [91] 0.40032895 0.74917763 0.20098684 0.20098684 0.20098684 0.33055921\n [97] 0.30065789 0.30065789 0.50000000 0.10131579 0.20098684 0.30065789\n[103] 0.25082237 0.10131579 0.10131579 0.30065789 0.50000000 0.25082237\n[109] 0.33055921 0.99835526 0.99835526 0.40032895 0.15115132 0.20098684\n[115] 0.50000000 0.74917763 0.10131579 0.10131579 0.10131579 0.05148026\n[121] 0.50000000 0.10131579 0.50000000 0.99835526 0.50000000 0.33055921\n[127] 0.99835526 0.99835526 0.50000000 0.33055921 0.50000000 0.33055921\n[133] 0.50000000 0.50000000 0.50000000 0.33055921 0.50000000 0.33055921\n[139] 0.99835526 0.50000000 0.50000000 0.25082237 0.25082237 0.40032895\n[145] 0.50000000 0.50000000 0.50000000 0.99835526 0.50000000 0.33055921\n[151] 0.50000000 0.25082237 0.25082237 0.50000000 0.50000000 0.74917763\n[157] 0.25082237 0.25082237 0.99835526 0.50000000 0.40032895 0.30065789\n[163] 0.10131579 0.50000000 0.25082237 0.25082237 0.15115132 0.40032895\n[169] 0.50000000 0.50000000 0.74917763 0.50000000 0.30065789 0.50000000\n[175] 0.33055921 0.50000000 0.33055921 0.10131579 0.20098684 0.20098684\n[181] 0.50000000 0.15115132 0.15115132 0.30065789 0.10131579 0.33055921\n[187] 0.50000000 0.74917763 0.33055921 0.33055921 0.99835526 0.25082237\n[193] 0.99835526 0.99835526 0.74917763 0.50000000 0.25082237 0.50000000\n[199] 0.25082237 0.25082237 0.99835526 0.25082237 0.50000000 0.50000000\n[205] 0.50000000 0.50000000 0.65947368 0.99835526 0.50000000 0.74917763\n[211] 0.99835526 0.99835526 0.10131579 0.59967105 0.30065789 0.20098684\n[217] 0.25082237 0.10131579 0.99835526 0.99835526 0.25082237 0.25082237\n[223] 0.25082237 0.50000000 0.50000000 0.99835526 0.50000000 0.15115132\n[229] 0.25082237 0.25082237 0.50000000 0.50000000 0.10131579 0.25082237\n[235] 0.10131579 0.25082237 0.10131579 0.79901316 0.50000000 0.05148026\n[241] 0.10131579 0.74917763 0.50000000 0.50000000 0.50000000 0.74917763\n[247] 0.50000000 0.25082237 0.25082237 0.50000000 0.50000000 0.50000000\n[253] 0.50000000 0.50000000 0.74917763 0.33055921 0.50000000 0.33055921\n[259] 0.50000000 0.50000000 0.65947368 0.50000000 0.99835526 0.99835526\n[265] 0.50000000 0.50000000 0.50000000 0.50000000 0.50000000 0.33055921\n[271] 0.50000000 0.50000000 0.50000000 0.99835526 0.33055921 0.50000000\n[277] 0.99835526 0.50000000 0.50000000 0.50000000 0.50000000 0.25082237\n[283] 0.50000000 0.25082237 0.10131579 0.10131579 0.25082237 0.74917763\n[289] 0.89868421 0.74917763 0.25082237 0.50000000 0.50000000 0.50000000\n[295] 0.50000000 0.50000000 0.50000000 0.50000000 0.74917763 0.50000000\n[301] 0.74917763 0.33055921 0.50000000 0.33055921\n```\n:::\n\n```{.r .cell-code}\nforage_org <- betareg(PropNotEat_adj ~ PreyCat + DT, data = forage)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in betareg.fit(X, Y, Z, weights, offset, link, link.phi, type, control,\n: no valid starting value for precision parameter found, using 1 instead\n```\n:::\n\n```{.r .cell-code}\n#summary(forage_interaction)\n\n# Compare models (lowest AIC) (Akaike's An Information Criterion for log-link)\n\nAIC(forage_interaction_added, forage_interaction, forage_interaction_age, forage_beta, forage_org)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                         df         AIC\nforage_interaction_added 12  0.09461034\nforage_interaction       11 -1.88836548\nforage_interaction_age    9 -5.67544028\nforage_beta               8 -7.51623184\nforage_org                7 -9.50307511\n```\n:::\n:::\n\n\n-   The statistical model is explained conceptually and using formal statistical notation\n\n-   The blog post demonstrates how to simulate data according to model assumptions\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create simulated dataset (values for predictions) \nsimulated_forage <- expand.grid(\n  PreyCat = levels(factor(forage$PreyCat)),\n  #age = levels(factor(forage$age)),\n  #sex = levels(factor(forage$sex)),\n  DT = seq(min(forage$DT), max(forage$DT), length.out = 40) # 100 obs yeilds closest recovered parameter values\n  )\n\n\nstr(simulated_forage)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n'data.frame':\t200 obs. of  2 variables:\n $ PreyCat: Factor w/ 5 levels \"Clam\",\"Crab\",..: 1 2 3 4 5 1 2 3 4 5 ...\n $ DT     : num  3 3 3 3 3 ...\n - attr(*, \"out.attrs\")=List of 2\n  ..$ dim     : Named int [1:2] 5 40\n  .. ..- attr(*, \"names\")= chr [1:2] \"PreyCat\" \"DT\"\n  ..$ dimnames:List of 2\n  .. ..$ PreyCat: chr [1:5] \"PreyCat=Clam\" \"PreyCat=Crab\" \"PreyCat=Cucumber\" \"PreyCat=Star\" ...\n  .. ..$ DT     : chr [1:40] \"DT=  3.000000\" \"DT=  9.435897\" \"DT= 15.871795\" \"DT= 22.307692\" ...\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Extract fitted param (phi and mean)\ncoef_vector <- coef(forage_org) # Create vector of the coefficients\ncoef_mean <- coef_vector[names(coef_vector) != \"(phi)\"] # Do not include phi in estimates\n\nsim_phi <- coef(forage_org)[7] # phi (precision) parameter\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Predict mean response for all predictors\nmu_response_sim <- predict(forage_org,\n                  newdata = simulated_forage,\n                  type = \"response\") # I just set it to response bc I don't think we need link space here... no need to undo with plogis since not in link space\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Recall the equation for parameterization of alpha and beta (https://search.r-project.org/CRAN/refmans/betareg/html/dbetar.html)\nalpha <- mu_response_sim * sim_phi\nbeta <- (1-mu_response_sim) * sim_phi\n# Simulate on response using rbeta()... generate random values in (0,1) using predicted mean and precision\nsimulated_forage$PropNotEat_adj <- rbeta(nrow(simulated_forage), alpha, beta)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Refit model with simulated data\nsim_forage_model <- betareg(PropNotEat_adj ~ PreyCat + DT, data = simulated_forage)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in betareg.fit(X, Y, Z, weights, offset, link, link.phi, type, control,\n: no valid starting value for precision parameter found, using 1 instead\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a data frame to compare coefficents (convert to kable extra)\noriginal_recovered_coef <- data.frame(\n  term = names(coef_mean),\n  original = coef_mean,\n  recovered = coef(sim_forage_model)[names(coef_mean)]\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(original_recovered_coef, n=6)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                           term     original    recovered\n(Intercept)         (Intercept)  0.661698472  0.468304173\nPreyCatCrab         PreyCatCrab -0.280232706 -0.030074480\nPreyCatCucumber PreyCatCucumber -0.411384070 -0.380476013\nPreyCatStar         PreyCatStar -0.014339710  0.085942159\nPreyCatUrchin     PreyCatUrchin -0.184978548  0.229856298\nDT                           DT -0.004531323 -0.004103654\n```\n:::\n:::\n\n\n-   The blog post demonstrates that a model fit to the simulated data recovers the parameters\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a function to run this workflow many times... generate lots of sampled coefs\nsimulate_forage <- forage %>% select(DT, PreyCat)\n\nsimulate_beta_and_fit <- function(model_fit, data){\n  # Create prediction values for the mean\n  sim_mean <- predict(model_fit, newdata = data, type = \"response\") # stay in response space \n  # Use '$' to extract phi from coefficients\n  sim_phi <-  model_fit$coefficients$precision # phi (precision) parameter\n  \n  # Reparamiterize alpha and beta ()\n  alpha <- sim_mean * sim_phi\n  beta <- (1-sim_mean) * sim_phi\n  \n  # Simulate response (PropNotEat_adj) with rbeta() syntax\n  data$PropNotEat_adj <- rbeta(nrow(data), alpha, beta)\n\n  # Fit model on simulated data\n  sim_forage_model <- betareg(PropNotEat_adj ~ PreyCat + DT, data = data)\n  \n  # Extract original and simulated means\n  coef_mean <- coef(model_fit)\n  coef_recovered  <- coef(sim_forage_model)\n\n  # Return data frame\n  original_recovered_coefs <- data.frame(\n    term = names(coef_mean), # Predictor/coefficient name\n    original = coef_mean, # Original model (forage_org) \n    recovered = coef_recovered[names(coef_mean)]\n  )\n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Simulate 50 times using map_dfr()\ncoef_sim_df <- map_dfr(1:50, # Sequence of numbers to simulate by\n                       # Create a function to run simulation function multiple times\n                       function(x) simulate_beta_and_fit(forage_org, simulate_forage))\n```\n:::\n\n\n### **Inference**\n\n-   Hypotheses are stated in plain language and with visualizations\n\n-   Model estimates are presented with appropriate uncertainty (e.g., confidence inter\n\n-   vals)\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a function to generate boot samples\n```\n:::\n\n\n-   A hypothesis is tested and the evidence is interpreted\n\n### **Professionalism**\n\n-   The overall appearance of the blog post (e.g., figures, code outputs) is portfolio-quality\n\n-   The writing is comprehensible to a technical audience\n\n-   The code is well-organized and appropriately documented\n",
    "supporting": [
      "blog_post_draft_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}