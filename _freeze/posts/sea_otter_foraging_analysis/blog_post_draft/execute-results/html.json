{
  "hash": "7da3b4ab18b4a6129d76108dd34fcbb3",
  "result": {
    "markdown": "---\ntitle: \"\"\nformat: html\n---\n\n\n# Assessing Sea Otter Feeding Habitats Based on Prey Type and Dive Depth\n\n*Currently under construction: Some sections do not have descriptions and will be updated by this Saturday.*\n\n### **Purpose**\n\nThe sea otter (*Enhydra lutris*) is a highly social marine mammal that plays a vital role as a keystone species in maintaining the health of kelp forest ecosystems by controlling sea urchin populations. Although sea otters are primary predators of sea urchins, their diet is diverse and includes a wide variety of prey types. For example, sea otters in Alaska are known to consume a wide range of prey, including clams, crabs, sea urchins, sea cucumbers, and snails (LaRoche et al., 2018). In recolonized areas of Southeast Alaska, clams are strongly selected despite their relatively low abundance, reflecting their high quality value. Similarly, sea urchins dominate diets primarily in rocky reef habitats where they are more abundant (LaRoche et al., 2018).\n\n![](images/clipboard-1982355787.png)\n\nThe proportion of prey not eaten provides a measure of foraging efficiency and prey handling success, reflecting both biological constraints and behavioral choices during feeding. Because of their important role as a keystone species, understanding their diet and foraging patterns is essential for assessing feeding preferences and food availability in conservation.\n\nThis blog post aims to present and discuss the results of a statistical regression analysis conducted on sea otter foraging data collected from visual observations in Prince of Wales, Alaska, by LaRoche et al. (2018). A beta regression using `glmmTMB` with a zero-adjustment was selected for the analysis in order to assess the proportion of prey not consumed by sea otters during summer 2018. The following question was utilized to guide the analysis:\n\n**How does prey categorization and dive depth predict the proportion of prey not eaten?**\n\nThe mean proportion not eaten was modeled using a Beta regression with a logit link, while a precision parameter (ϕ) captured the variability in proportions around the mean.\n\n$$\n\\text{PropNotEaten} \\sim \\text{Beta}(\\alpha, \\beta)\n$$\n\n$$\nlogit(\\mu_i)\n= \\beta_{0}\n+ \\beta_{diveTime} \n+ \\beta_{PreyCat\\_urchin} \n+ \\beta_{PreyCat\\_crab} \n+ \\beta_{PreCat\\_cucumber} \n+ \\beta_{PreCat\\_star}  \n$$\n\n-   **Hypothesis 1:**\n\n    -   H~0~: β~PreyCat_urchins~ = 0. Sea otters leave the same proportion of urchins uneaten as they do with clams; prey category does not influence the proportion of prey eaten.\n\n    -   HA: β~PreyCat_urchins~ ≠ 0. Sea otters leave a significantly different proportion of urchins uneaten compared to clams; prey category has a significant effect on the proportion of prey not eaten.\n\n-   **Hypothesis 2**:\n\n    -   H0: β~dive_time~ = 0. Dive time has no significant effect on the proportion of prey not eaten; the duration of a dive does not influence how much prey is not eaten.\n\n    -   HA: β~dive_time~ ≠ 0. Dive time does significantly affect the proportion of prey not eaten; longer or shorter dives are associated with a higher or lower proportion of prey left uneaten.\n\nThe categorical variable `PreyCat` represents the general prey categorization of a prey type. In particular, clams and urchins differ biologically in handling difficulty and energetic return. Urchins may require more processing and include defensive structures (spines), whereas clams require shell-breaking but offer concentrated soft tissue. These differences potentially influence the proportion of prey successfully consumed, indicating a direct causal effect of prey category on the proportion of prey not consumed\n\nAdditionally, prey category may influence dive duration because hunting, handling, and extracting different prey may require different levels of effort and time. Thus, prey category potentially influences dive time, which in turn affects the proportion of prey not eaten.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show code\"}\n# Create a DAG using dagitty package... relate to each variable \nlibrary(dagitty)\ndag <- dagitty(\"dag { \n  PreyCat -> DT \n  DT -> PropNotEat\n  PreyCat -> PropNotEat\n}\")\n\nplot(dag) # Visualize DAG\n```\n\n::: {.cell-output-display}\n![](blog_post_draft_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n### Data Importation, Exploration, and Cleaning\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show code\"}\nlibrary(here)\nlibrary(tidyverse)\nlibrary(betareg) # https://cran.r-project.org/web/packages/betareg/vignettes/betareg.html#sec-model\nlibrary(glmmTMB)\nlibrary(broom)         \nlibrary(broom.mixed) # for glmmTMB mixed model\nlibrary(kableExtra)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)\nforage <- read_csv(\"forage_final (1).csv\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Inspect first few rows\nhead(forage)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 36\n  BoutID   Study Date  BoutStart BoutEnd DiveNo    DT    ST Suc      HT PreyItem\n  <chr>    <chr> <chr> <time>    <time>   <dbl> <dbl> <dbl> <chr> <dbl> <chr>   \n1 2018-001 POW   5/6/… 11:24     11:51        1    76    33 N        NA <NA>    \n2 2018-001 POW   5/6/… 11:24     11:51        2   135    26 Y        24 SAG     \n3 2018-001 POW   5/6/… 11:24     11:51        3    55    12 Y        12 CLA     \n4 2018-001 POW   5/6/… 11:24     11:51        4    52    21 Y        21 CLA     \n5 2018-001 POW   5/6/… 11:24     11:51        5    40    17 Y        17 SAG     \n6 2018-001 POW   5/6/… 11:24     11:51        6    81    22 N        NA <NA>    \n# ℹ 25 more variables: PreyQty <dbl>, PreySz <chr>, PropNotEat <dbl>,\n#   Why....Notes...Tool.Use <chr>, Region <chr>, YEAR <dbl>, ObsLatDeg <dbl>,\n#   ObsLongDeg <dbl>, OtterLatDeg <dbl>, OtterLongDeg <dbl>, age <chr>,\n#   sex <chr>, pup <chr>, where <chr>, obscond <chr>, Rain <chr>, Sky <dbl>,\n#   observer <chr>, recorder <chr>, EnteredBy <chr>, checked.by <chr>,\n#   PreyCat <chr>, Occupation <chr>, julian <dbl>, Season <chr>\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Drop NAs \n# Select for just prey category, diving time, and age\nforage <- forage %>% select(PreyCat, PropNotEat, DT, age)\nforage <- forage %>% filter(age != \"U\") \nforage <- forage %>% drop_na()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Check the colSums... were they all dropped?\ncolSums(is.na(forage)) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   PreyCat PropNotEat         DT        age \n         0          0          0          0 \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show code\"}\n# Create a scatterplot of dive time related to the proportion of prey not eaten based on prey category\nforage %>% ggplot(aes(x = DT, y = PropNotEat))+ geom_jitter() + theme_bw() +  #+ scale_color_discrete(palette = \"Set2\") + \n#   #facet_wrap(~PreyCat, scale = \"free\") + \n  #theme(legend.position = \"none\") + \nlabs(x = \"Diving Time (seconds)\", y = \"Proportion of Prey Not Eaten\", \n                                               title = \"Proportion of Prey Not Consumed By Sea Otters Based on Diving Time\") + theme(plot.title = element_text(size = 11, face = \"bold\"))\n```\n\n::: {.cell-output-display}\n![](blog_post_draft_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show code\"}\n# Create boxplots to visualize the distribution of prey categories and proportion of prey not eaten\nforage %>% ggplot(aes(x = PreyCat, y = PropNotEat, fill = PreyCat)) + geom_boxplot() + scale_fill_manual(values = c(\n    \"Clam\" = \"#1b9e77\",\n    \"Urchin\" = \"#d95f02\",\n    \"Crab\" = \"#7570b3\",\n    \"Cucumber\" = \"#66a61e\",\n    \"Star\" = \"#e6ab02\"\n  )) + theme_bw()\n```\n\n::: {.cell-output-display}\n![](blog_post_draft_files/figure-html/unnamed-chunk-7-2.png){width=672}\n:::\n:::\n\n\n### Data Simulation Procedure\n\nHere, simulated data was generated to evaluate model performance, explore parameter recovery, and verify that the fitted model behaves as expected. As cited in the `betareg` CRAN project, the\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Beta does not take direct 0 and 1! need to do adjustment to offset before 1 and after 0 ()\nforage <- forage %>%\n  mutate(PropNotEat_adj = # Transformation to adjust (betareg cranr)\n           (PropNotEat * (nrow(.) - 1) + 0.5) / nrow(.))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Original model\nforage_beta <- glmmTMB(\n  PropNotEat_adj ~ DT + PreyCat,\n  data = forage,\n  family = beta_family(link = \"logit\")\n)\n\n\n# Model with interaction between PreyCat and DT\nforage_interaction <- forage_org <- glmmTMB(\n  PropNotEat_adj ~ PreyCat * DT,\n  data = forage,\n  family = beta_family(link = \"logit\")\n)\n\n# Compare models (lowest AIC) (Akaike's An Information Criterion for log-link)\nAIC(forage_beta, forage_interaction)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                   df       AIC\nforage_beta         7 -19.32321\nforage_interaction 11 -12.10524\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Reset seed (redefined)\nset.seed(123)\n\n# Define simulated obs... with law of large numbers, larger sample size should get closer to actual predictors\nn_sim <- 15000\n\n# Define coefficients from original model\nbeta0 <- 0.738077 \nbeta_dive_time <- -0.004949 \nbeta_crab <- -0.265717\nbeta_cucumber <- -0.449131\nbeta_star <- -0.240470 \nbeta_urchin <-  -0.205423\nphi <- 1.72 # Precision\n\n## Simulate range for predictors\ndt <- runif(n_sim, 3, 255) # Range of dive time\n\n# Randomly generate PreyCat factors for simulated data... then for each level, sample with replacement to get vector of length n_sim\nPreyCat <- sample(c(\"Clam\",\"Crab\",\"Cucumber\",\"Star\",\"Urchin\"), n_sim, replace = TRUE)\n\n## Define linear predictor and logit equation\n# Assign coefficient to each PreyCat level\nprey_effect <- ifelse(PreyCat == \"Crab\", beta_crab,\n               ifelse(PreyCat == \"Cucumber\", beta_cucumber,\n               ifelse(PreyCat == \"Star\", beta_star,\n               ifelse(PreyCat == \"Urchin\", beta_urchin, \n               0)))) # Else assign clam (reference)\n\nglm_eq <- beta0 + beta_dive_time * dt + prey_effect # Recall that prey_effect has the associated beta coefficient for each level\n\n# Convert linear predictor (logit scale) to  mean proportion on  response scale\nmean_sim <- exp(glm_eq) / (1 + exp(glm_eq))\n\n# Reparameterize beta distribution parameters (derived from CRAN at (https://search.r-project.org/CRAN/refmans/betareg/html/dbetar.html)\nalpha <- mean_sim * phi\nbeta <- (1 - mean_sim) * phi\n\n# Simulate response variable from beta distribution using calculated alpha and beta \nPropNotEat_adj <- rbeta(n_sim, alpha, beta)\n\n# Create simulated data frame\nsimulated_forage <- data.frame(\n  PropNotEat_adj = PropNotEat_adj,\n  DT = dt,\n  PreyCat = factor(PreyCat, levels = c(\"Clam\",\"Crab\",\"Cucumber\",\"Star\",\"Urchin\"))\n)\n\n# Fit simulated model\nsim_model <- glmmTMB(\n  PropNotEat_adj ~ DT + PreyCat,\n  data = simulated_forage,\n  family = beta_family(link = \"logit\")\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Compare coefficients\nsummary(sim_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n Family: beta  ( logit )\nFormula:          PropNotEat_adj ~ DT + PreyCat\nData: simulated_forage\n\n      AIC       BIC    logLik -2*log(L)  df.resid \n  -2747.9   -2694.6    1381.0   -2761.9     14993 \n\n\nDispersion parameter for beta family (): 1.71 \n\nConditional model:\n                  Estimate Std. Error z value Pr(>|z|)    \n(Intercept)      0.7406679  0.0270753   27.36  < 2e-16 ***\nDT              -0.0050162  0.0001319  -38.03  < 2e-16 ***\nPreyCatCrab     -0.2196297  0.0297231   -7.39 1.48e-13 ***\nPreyCatCucumber -0.4368883  0.0297059  -14.71  < 2e-16 ***\nPreyCatStar     -0.2597803  0.0297271   -8.74  < 2e-16 ***\nPreyCatUrchin   -0.2300222  0.0296505   -7.76 8.64e-15 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\nsummary(forage_beta)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n Family: beta  ( logit )\nFormula:          PropNotEat_adj ~ DT + PreyCat\nData: forage\n\n      AIC       BIC    logLik -2*log(L)  df.resid \n    -19.3       6.9      16.7     -33.3       307 \n\n\nDispersion parameter for beta family (): 1.72 \n\nConditional model:\n                 Estimate Std. Error z value Pr(>|z|)    \n(Intercept)      0.738077   0.167395   4.409 1.04e-05 ***\nDT              -0.004949   0.001488  -3.325 0.000883 ***\nPreyCatCrab     -0.265717   0.163181  -1.628 0.103449    \nPreyCatCucumber -0.449131   0.240548  -1.867 0.061886 .  \nPreyCatStar     -0.240470   0.447564  -0.537 0.591071    \nPreyCatUrchin   -0.205423   0.340147  -0.604 0.545895    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\n### **Inference**\n\n-   Model estimates are presented with appropriate uncertainty (e.g., confidence intervals)\n\n\\[Extracting CIs via bootstrapping: Accompanying uncertainty estimates coming soon...\\]\n\n\\[Further interpretation coming soon...\\]\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Build prediction grid\npredicted_data <- expand.grid(\n  # Establish sequency for predictor range (DT)\n  DT = seq(min(forage$DT, na.rm = TRUE), max(forage$DT, na.rm = TRUE), length.out = 100),\n  PreyCat = levels(factor(forage$PreyCat)) # Convert to factor\n)\n\n# Ensure levels in predicted_data exactly match in forage$PreyCat\npredicted_data$PreyCat <- factor(predicted_data$PreyCat, levels = levels(factor(forage$PreyCat)))\n\n# Predict with glmmTMB()\npredicted_data$predicted_PropNotEaten <- predict(\n  forage_beta, \n  newdata = predicted_data,\n  type = \"response\" \n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Plot fitted lines per prey category\npredicted_data %>% \n  ggplot(aes(x = DT, y = predicted_PropNotEaten, color = PreyCat)) +\n  geom_line(size = 1) +\n  labs(\n    title = \"Effect of Dive Time on Predicted Proportion Not Eaten Based on Prey Category\",\n    x = \"Dive Time (seconds)\",\n    y = \"Predicted Proportion Not Eaten\"\n  ) +\n  theme_minimal() +\n  scale_color_brewer(palette = \"Set1\")\n```\n\n::: {.cell-output-display}\n![](blog_post_draft_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\nFor future analysis, the age (adult and juvenile) of observed sea otters may be considered as a potential confounding variable impacting diving time, preference for prey, and the proportion of prey left uneaten.\n",
    "supporting": [
      "blog_post_draft_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}